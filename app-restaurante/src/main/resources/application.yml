spring:
  application:
    name: app-restaurante
  #Configuracion para la base de datos
  datasource:
    url: ${DB_URL}
    username: ${DB_USERNAME}
    password: ${DB_PASSWORD}
    driver-class-name: com.mysql.cj.jdbc.Driver
    hikari:
      maximum-pool-size: ${DB_POOL_SIZE:10}
      minimum-idle: ${DB_MIN_IDLE:5}
      connection-timeout: ${DB_CONNECTION_TIMEOUT:30000}
  jpa:
    hibernate:
      ddl-auto: ${HIBERNATE_DDL_AUTO:none}
    open-in-view: false
    properties:
      hibernate:
        format_sql: ${HIBERNATE_FORMAT_SQL:false}
        show_sql: ${HIBERNATE_SHOW_SQL:false}
        use_sql_comments: false
    show-sql: false
  jackson:
    deserialization:
      fail-on-unknown-properties: false
  servlet:
    multipart:
      enabled: true
      max-file-size: ${MAX_FILE_SIZE:10MB}
      max-request-size: ${MAX_REQUEST_SIZE:10MB}
  cache:
    type: caffeine
    cache-names: categories, subCategories, products, statistics
  mail:
    host: ${SMTP_HOST:smtp.gmail.com}
    port: ${SMTP_PORT:587}
    username: ${SMTP_USERNAME}
    # Para Gmail: usa una contraseña de aplicación (sin espacios) o ponla entre comillas si tiene espacios
    # Genera una contraseña de aplicación en: https://myaccount.google.com/apppasswords
    password: ${SMTP_PASSWORD}
    properties:
      mail:
        smtp:
          auth: ${SMTP_AUTH:true}
          starttls:
            enable: ${SMTP_STARTTLS:true}
            required: ${SMTP_STARTTLS_REQUIRED:true}
          connectiontimeout: 5000
          timeout: 5000
          writetimeout: 5000
    from: ${EMAIL_FROM:noreply@restaurante.com}
    from-name: ${EMAIL_FROM_NAME:Restaurante App}

server:
  address: 0.0.0.0  # Escucha en todas las interfaces de red (permite acceso desde otras máquinas)
  port: ${PORT:8080}  # Railway usa PORT, localmente usa 8080


management:
  endpoints:
    web:
      exposure:
        include: health,info,metrics
  endpoint:
    health:
      show-details: when-authorized

app:
  cors:
    # Permite acceso desde localhost en desarrollo
    # En producción, configurar CORS_ALLOWED_ORIGINS con el dominio del frontend
    allowed-origins: ${CORS_ALLOWED_ORIGINS:http://localhost:4200,http://127.0.0.1:4200}
    allowed-methods: ${CORS_ALLOWED_METHODS:GET,POST,PUT,DELETE,OPTIONS}
  admin:
    email: ${ADMIN_EMAIL:admin@restaurante.com}

#Configuracion para Cloudinary para el almacenamiento de imagenes
cloudinary:
  cloud-name: ${CLOUDINARY_CLOUD_NAME}
  api-key: ${CLOUDINARY_API_KEY}
  api-secret: ${CLOUDINARY_API_SECRET}
  upload:
    folder: ${CLOUDINARY_FOLDER:restaurante}

#Configuracion para JWT
jwt:
  secret: ${JWT_SECRET}
  expiration: ${JWT_EXPIRATION:86400000} # 24 horas en milisegundos

#Configuracion de rate limiting
rate-limit:
  login:
    requests-per-minute: ${RATE_LIMIT_LOGIN:5}
    window-minutes: ${RATE_LIMIT_WINDOW:1}
  api:
    requests-per-minute: ${RATE_LIMIT_API:100}
    window-minutes: ${RATE_LIMIT_WINDOW:1}

#Configuracion de logging
logging:
  level:
    root: ${LOG_LEVEL:INFO}
    com.rds.app_restaurante: ${APP_LOG_LEVEL:INFO}
    org.springframework.security: ${SECURITY_LOG_LEVEL:WARN}
    org.hibernate: ${HIBERNATE_LOG_LEVEL:WARN}
  pattern:
    console: "%d{yyyy-MM-dd HH:mm:ss} - %msg%n"
    file: "%d{yyyy-MM-dd HH:mm:ss} [%thread] %-5level %logger{36} - %msg%n"
  file:
    name: ${LOG_FILE:logs/app-restaurante.log}
    max-size: ${LOG_MAX_SIZE:10MB}
    max-history: ${LOG_MAX_HISTORY:30}

---
# Perfil de desarrollo
spring:
  config:
    activate:
      on-profile: dev
  jpa:
    properties:
      hibernate:
        format_sql: true
        show_sql: true

logging:
  level:
    com.rds.app_restaurante: DEBUG
    org.springframework.web: DEBUG

---
# Perfil de producción
spring:
  config:
    activate:
      on-profile: prod
  jpa:
    hibernate:
      ddl-auto: validate  # Validar schema, NO modificar en producción
    properties:
      hibernate:
        format_sql: false
        show_sql: false

management:
  endpoints:
    web:
      exposure:
        include: health,info  # Solo health e info en producción

logging:
  level:
    root: WARN
    com.rds.app_restaurante: INFO
    org.springframework.security: WARN
    org.hibernate: WARN
