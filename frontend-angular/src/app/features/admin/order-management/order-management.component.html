<div class="order-management">
  <div class="header">
    <h2>Gestión de Pedidos</h2>
    <button (click)="loadOrders()" class="btn-refresh" [disabled]="loading()">Actualizar</button>
  </div>

  @if (errorMessage()) {
    <div class="alert alert-error">{{ errorMessage() }}</div>
  }

  <div class="filters">
    <button 
      [class.active]="filterType() === 'all'"
      (click)="filterType.set('all'); loadOrders()"
      class="filter-btn"
    >
      Todos
    </button>
    <button 
      [class.active]="filterType() === OrderType.EN_MESA"
      (click)="filterType.set(OrderType.EN_MESA); loadOrders()"
      class="filter-btn"
    >
      En Mesa
    </button>
    <button 
      [class.active]="filterType() === OrderType.DOMICILIO"
      (click)="filterType.set(OrderType.DOMICILIO); loadOrders()"
      class="filter-btn"
    >
      Domicilio
    </button>
  </div>

  @if (loading() && orders().length === 0) {
    <div class="loading">Cargando pedidos...</div>
  } @else {
    <div class="orders-table">
      <table>
        <thead>
          <tr>
            <th>ID</th>
            <th>Cliente</th>
            <th>Tipo</th>
            <th>Fecha</th>
            <th>Hora</th>
            <th>Total</th>
            <th>Estado</th>
            <th>Detalles</th>
          </tr>
        </thead>
        <tbody>
          @for (order of getFilteredOrders(); track order.id) {
            <tr [class.completed]="order.status" [class.pending]="!order.status">
              <td>#{{ order.id }}</td>
              <td>{{ order.userName }}<br><small>{{ order.userEmail }}</small></td>
              <td>
                <span class="type-badge" [class.en-mesa]="order.type === OrderType.EN_MESA" [class.domicilio]="order.type === OrderType.DOMICILIO">
                  {{ getOrderTypeLabel(order.type) }}
                </span>
              </td>
              <td>{{ formatDate(order.date) }}</td>
              <td>{{ formatTime(order.time) }}</td>
              <td class="price">${{ order.totalPrice | number:'1.2-2' }}</td>
              <td>
                <span class="status-badge" [class.completed]="order.status">
                  {{ order.status ? 'Completado' : 'Pendiente' }}
                </span>
              </td>
              <td class="details-cell">
                @if (order.type === OrderType.EN_MESA && order.tableNumber) {
                  <div><strong>Mesa:</strong> {{ order.tableNumber }}</div>
                }
                @if (order.type === OrderType.DOMICILIO) {
                  <div><strong>Dirección:</strong> {{ order.deliveryAddress }}</div>
                  @if (order.deliveryPhone) {
                    <div><strong>Tel:</strong> {{ order.deliveryPhone }}</div>
                  }
                }
                @if (order.items && order.items.length > 0) {
                  <div><strong>Productos:</strong> {{ order.items.length }} item(s)</div>
                }
              </td>
            </tr>
          }
          @if (getFilteredOrders().length === 0) {
            <tr>
              <td colspan="8" class="no-data">No hay pedidos</td>
            </tr>
          }
        </tbody>
      </table>
    </div>
  }
</div>

