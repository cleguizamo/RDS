<div class="category-management">
  <div class="header">
    <h2>Gestión de Categorías</h2>
    <button 
      class="btn-add" 
      (click)="toggleForm()"
      [disabled]="loading() || showForm()"
    >
      + Agregar Categoría
    </button>
  </div>

  @if (errorMessage()) {
    <div class="alert alert-error">{{ errorMessage() }}</div>
  }

  @if (successMessage()) {
    <div class="alert alert-success">{{ successMessage() }}</div>
  }

  <!-- Formulario de categoría -->
  @if (showForm()) {
    <div class="category-form">
      <h3>{{ editingCategory() ? 'Editar Categoría' : 'Agregar Nueva Categoría' }}</h3>
      
      <form [formGroup]="categoryForm" (ngSubmit)="onSubmit()">
        <div class="form-group">
          <label for="name">Nombre *</label>
          <input 
            type="text" 
            id="name" 
            formControlName="name"
            [class.error]="categoryForm.get('name')?.invalid && categoryForm.get('name')?.touched"
            [disabled]="loading()"
          />
          @if (categoryForm.get('name')?.invalid && categoryForm.get('name')?.touched) {
            <small class="error-text">{{ getErrorMessage('name') }}</small>
          }
        </div>

        <div class="form-group">
          <label for="description">Descripción</label>
          <textarea 
            id="description" 
            formControlName="description"
            rows="3"
            [disabled]="loading()"
          ></textarea>
        </div>

        <div class="form-actions">
          <button 
            type="submit" 
            class="btn-save"
            [disabled]="loading() || categoryForm.invalid"
          >
            {{ loading() ? 'Guardando...' : (editingCategory() ? 'Actualizar' : 'Crear') }}
          </button>
          <button 
            type="button" 
            class="btn-cancel" 
            (click)="toggleForm()"
            [disabled]="loading()"
          >
            Cancelar
          </button>
        </div>
      </form>
    </div>
  }

  <!-- Buscador -->
  <div class="search-bar">
    <input 
      type="text" 
      placeholder="Buscar categorías..." 
      [(ngModel)]="searchTerm"
      (input)="onSearchChange(searchTerm())"
      [disabled]="loading()"
    />
  </div>

  <!-- Lista de categorías -->
  @if (loading() && categories().length === 0) {
    <div class="loading">Cargando categorías...</div>
  } @else if (!loading() && filteredCategories().length === 0) {
    <div class="empty-state">
      @if (searchTerm()) {
        <p>No se encontraron categorías que coincidan con la búsqueda.</p>
      } @else {
        <p>No hay categorías registradas. Crea tu primera categoría para comenzar.</p>
      }
    </div>
  } @else {
    <div class="categories-list">
      @for (category of filteredCategories(); track category.id) {
        <div class="category-card">
          <div class="category-info">
            <h3>{{ category.name }}</h3>
            @if (category.description) {
              <p>{{ category.description }}</p>
            }
            <div class="category-stats">
              <span class="product-count">{{ category.productCount || 0 }} producto(s)</span>
            </div>
          </div>
          <div class="category-actions">
            <button 
              class="btn-edit"
              (click)="toggleForm(category)"
              [disabled]="loading()"
            >
              Editar
            </button>
            <button 
              class="btn-delete"
              (click)="deleteCategory(category.id)"
              [disabled]="loading() || (category.productCount || 0) > 0"
              [title]="(category.productCount || 0) > 0 ? 'No se puede eliminar: tiene productos asociados' : 'Eliminar categoría'"
            >
              Eliminar
            </button>
          </div>
        </div>
      }
    </div>
  }
</div>

