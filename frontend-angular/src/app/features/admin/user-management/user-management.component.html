<div class="user-management">
  <div class="header">
    <h2>Gestión de Usuarios</h2>
    <button (click)="loadUsers()" class="btn-refresh" [disabled]="loading()">Actualizar</button>
  </div>

  @if (errorMessage()) {
    <div class="alert alert-error">{{ errorMessage() }}</div>
  }

  @if (successMessage()) {
    <div class="alert alert-success">{{ successMessage() }}</div>
  }

  @if (loading() && users().length === 0) {
    <div class="loading">Cargando usuarios...</div>
  } @else {
    <div class="users-container">
      <div class="users-list">
        <table>
          <thead>
            <tr>
              <th>ID</th>
              <th>Nombre</th>
              <th>Email</th>
              <th>Teléfono</th>
              <th>Pedidos</th>
              <th>Total Gastado</th>
              <th>Acciones</th>
            </tr>
          </thead>
          <tbody>
            @for (user of users(); track user.id) {
              <tr [class.selected]="selectedUser()?.id === user.id" (click)="selectUser(user)">
                <td>{{ user.id }}</td>
                <td>{{ user.name }} {{ user.lastName }}</td>
                <td>{{ user.email }}</td>
                <td>{{ user.phone }}</td>
                <td>{{ user.numberOfOrders }}</td>
                <td>${{ user.totalSpent | number:'1.2-2' }}</td>
                <td>
                  <button class="btn-edit" (click)="selectUser(user); $event.stopPropagation()">Editar</button>
                  <button class="btn-delete" (click)="deleteUser(user.id); $event.stopPropagation()">Eliminar</button>
                </td>
              </tr>
            }
          </tbody>
        </table>
      </div>

      @if (selectedUser() && editingUser()) {
        <div class="edit-panel">
          <h3>Editar Usuario</h3>
          <form (ngSubmit)="updateUser()">
            <div class="form-group">
              <label>Nombre</label>
              <input type="text" [(ngModel)]="editingUser()!.name" name="name" required />
            </div>

            <div class="form-group">
              <label>Apellido</label>
              <input type="text" [(ngModel)]="editingUser()!.lastName" name="lastName" required />
            </div>

            <div class="form-group">
              <label>Tipo de Documento</label>
              <select [(ngModel)]="editingUser()!.documentType" name="documentType" required>
                @for (type of documentTypes; track type) {
                  <option [value]="type">{{ type }}</option>
                }
              </select>
            </div>

            <div class="form-group">
              <label>Número de Documento</label>
              <input type="text" [(ngModel)]="editingUser()!.documentNumber" name="documentNumber" required />
            </div>

            <div class="form-group">
              <label>Teléfono</label>
              <input type="number" [(ngModel)]="editingUser()!.phone" name="phone" required />
            </div>

            <div class="form-group">
              <label>Email</label>
              <input type="email" [(ngModel)]="editingUser()!.email" name="email" required />
            </div>

            <div class="form-group">
              <label>Fecha de Nacimiento</label>
              <input type="date" [(ngModel)]="editingUser()!.dateOfBirth" name="dateOfBirth" required />
            </div>

            <div class="form-group">
              <label>Puntos</label>
              <input type="number" [(ngModel)]="editingUser()!.points" name="points" min="0" />
            </div>

            <div class="form-group">
              <label>Total Gastado</label>
              <input type="number" [(ngModel)]="editingUser()!.totalSpent" name="totalSpent" min="0" step="0.01" />
            </div>

            <div class="form-actions">
              <button type="submit" class="btn-save" [disabled]="loading()">Guardar</button>
              <button type="button" class="btn-cancel" (click)="cancelEdit()">Cancelar</button>
            </div>
          </form>
        </div>
      }
    </div>
  }
</div>

