<div class="dashboard-container">
  <div class="dashboard-header">
    <h1>Mi Cuenta</h1>
    <button (click)="logout()" class="btn-logout">Cerrar Sesión</button>
  </div>

  @if (loading()) {
    <div class="loading">Cargando información...</div>
  } @else if (errorMessage()) {
    <div class="alert alert-error">{{ errorMessage() }}</div>
  } @else if (userInfo()) {
    <div class="user-info-card">
      <div class="info-section">
        <h2>Información Personal</h2>
        <div class="info-grid">
          <div class="info-item">
            <label>Nombre Completo</label>
            <p>{{ userInfo()!.name }} {{ userInfo()!.lastName }}</p>
          </div>
          <div class="info-item">
            <label>Email</label>
            <p>{{ userInfo()!.email }}</p>
          </div>
          <div class="info-item">
            <label>Teléfono</label>
            <p>{{ userInfo()!.phone }}</p>
          </div>
          <div class="info-item">
            <label>Tipo de Documento</label>
            <p>{{ userInfo()!.documentType }}</p>
          </div>
          <div class="info-item">
            <label>Número de Documento</label>
            <p>{{ userInfo()!.documentNumber }}</p>
          </div>
          <div class="info-item">
            <label>Fecha de Nacimiento</label>
            <p>{{ userInfo()!.dateOfBirth | date:'mediumDate' }}</p>
          </div>
        </div>
      </div>

      <div class="stats-section">
        <h2>Estadísticas</h2>
        <div class="stats-grid">
          <div class="stat-card">
            <div class="stat-value">{{ userInfo()!.points }}</div>
            <div class="stat-label">Puntos Acumulados</div>
          </div>
          <div class="stat-card">
            <div class="stat-value">{{ userInfo()!.numberOfOrders }}</div>
            <div class="stat-label">Pedidos Realizados</div>
          </div>
          <div class="stat-card">
            <div class="stat-value">{{ userInfo()!.totalSpent | formatCurrency }}</div>
            <div class="stat-label">Total Gastado</div>
          </div>
          <div class="stat-card">
            <div class="stat-value">{{ userInfo()!.numberOfReservations }}</div>
            <div class="stat-label">Reservaciones</div>
          </div>
        </div>
        @if (userInfo()!.lastOrderDate) {
          <div class="last-order">
            <p><strong>Último pedido:</strong> {{ userInfo()!.lastOrderDate | date:'mediumDate' }}</p>
          </div>
        }
      </div>

      <div class="rewards-section">
        <h2>Canjear Puntos</h2>
        @if (successMessage()) {
          <div class="alert alert-success">{{ successMessage() }}</div>
        }
        @if (errorMessage()) {
          <div class="alert alert-error">{{ errorMessage() }}</div>
        }
        
        @if (loadingRewards()) {
          <div class="loading">Cargando recompensas...</div>
        } @else if (rewardProducts().length === 0) {
          <div class="empty-rewards">
            <p>No hay recompensas disponibles en este momento.</p>
          </div>
        } @else {
          <div class="rewards-grid">
            @for (reward of rewardProducts(); track reward.id) {
              <div class="reward-card" [class.available]="canRedeem(reward)" [class.unavailable]="!canRedeem(reward)">
                @if (reward.imageUrl) {
                  <div class="reward-image">
                    <img [src]="reward.imageUrl" [alt]="reward.name" />
                  </div>
                }
                <div class="reward-info">
                  <h3>{{ reward.name }}</h3>
                  @if (reward.description) {
                    <p class="reward-description">{{ reward.description }}</p>
                  }
                  <div class="reward-details">
                    <div class="points-required">
                      <span class="points-label">Puntos:</span>
                      <span class="points-value">{{ reward.pointsRequired }}</span>
                    </div>
                    @if (reward.stock > 0) {
                      <div class="stock">Stock: {{ reward.stock }}</div>
                    } @else {
                      <div class="stock out-of-stock">Sin stock</div>
                    }
                  </div>
                  <button 
                    class="btn-redeem"
                    (click)="redeemReward(reward)"
                    [disabled]="!canRedeem(reward)"
                    [title]="!canRedeem(reward) ? (userInfo()!.points < reward.pointsRequired ? 'No tienes suficientes puntos' : 'No disponible') : 'Canjear recompensa'">
                    {{ canRedeem(reward) ? 'Canjear' : 'No disponible' }}
                  </button>
                </div>
              </div>
            }
          </div>
        }
      </div>

      <div class="actions-section">
        <a [routerLink]="['/']" class="btn-primary">Ver Menú</a>
        <a [routerLink]="['/reservations']" class="btn-secondary">Hacer Reserva</a>
        <a [routerLink]="['/dashboard/orders']" class="btn-secondary">Historial de Pedidos</a>
      </div>
    </div>
  }
</div>

